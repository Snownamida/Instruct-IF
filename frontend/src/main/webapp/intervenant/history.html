<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Historique</title>
  <link rel="stylesheet" href="history.css" />
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
</head>

<body>
  <div class="navbar">
    <a href="demande.html">
      <button type="button" class="nav-button">Demande de cours</button>
    </a>
    <a href="history.html">
      <button type="button" class="nav-button active">Historique</button>
    </a>
    <a href="stats.html">
      <button type="button" class="nav-button">Statistiques</button>
    </a>
    <a href="profile.html">
      <button type="button" class="nav-button">Profil</button>
    </a>
    <button type="button" class="nav-button" onlclick="logout()">Déconnexion</button>
  </div>
  <h1>Historique de vos cours:</h1>
  <div class="history">
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Matière</th>
          <th>Eleve</th>
          <th>Durée</th>
          <th>Bilan</th>
        </tr>
      </thead>
      <tbody id="historyTableBody">
        <!-- Les demandes seront insérées ici -->
      </tbody>
    </table>
  </div>
</body>
<script>
  $(document).ready(() => {
    $.ajax({
      url: '../ActionServlet',
      method: 'POST',
      data: { todo: 'my-history' },
      dataType: 'json'
    })
      .done(function (response) {
        const historyTableBody = $('#historyTableBody');
        response.forEach(function (demande) {
          const row = '<tr>' +
            '<td>' + new Date(demande.dateDebut).toLocaleDateString() + '</td>' +
            '<td>' + demande.matiere.denomination + '</td>' +
            '<td>' + demande.eleveDto.nom + ' ' + demande.eleveDto.prenom + '</td>' +
            '<td>' + formatDuration(demande.duree) + '</td>' +
            '<td>' + demande.description + '</td>' +
            '</tr>';
          historyTableBody.append(row);

        });
      })
      .fail(function (error) {
        console.error('Erreur lors de la récupération de l\'historique des demandes:', error);
      });
  });
  
  // Fonction pour formater la durée en heures, minutes et secondes
  function formatDuration(duration) {
    const seconds = parseInt(duration, 10) % 60;
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    return hours + 'h' + (minutes < 10 ? '0' : '') + minutes + 'min' + (seconds < 10 ? '0' : '') + seconds + 's';
  }

  function logout() {
    $.ajax({
      url: '../ActionServlet',
      method: 'POST',
      data: { todo: 'signout' },
      dataType: 'json'
    })
      .done((response) => {
        window.location.href = '../index.html';
      })
      .fail((error) => {
        console.error('Erreur lors de la déconnexion:', error);
      });
  }
</script>

</html>